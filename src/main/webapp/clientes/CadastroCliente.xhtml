<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template/LayoutPadrao.xhtml">

    <ui:define name="titulo">Novo cliente</ui:define>

    <ui:define name="corpo">
        <h1>Novo cliente</h1>

        <h:form id="frm">

            <p:messages id="msg" closable="true"/>

            <p:toolbar style="margin-top: 20px" id="tollbar">
                <p:toolbarGroup>
                    <p:button value="Novo" outcome="/clientes/CadastroCliente"/>
                    <p:commandButton value="Salvar" id="btnSalvar" action="#{cadastroClienteBean.salvar}"
                                     update="frm:msg frm:tollbar frm:painel"
                                     process="frm:tollbar frm:painel"/>
                </p:toolbarGroup>
                <p:toolbarGroup align="right">
                    <p:button value="Pesquisar" outcome="/clientes/PesquisaClientes"/>
                </p:toolbarGroup>
            </p:toolbar>

            <p:panelGrid columns="2" style="margin-top: 20px; margin-left: -10px"
                         columnClasses="rotulo, campo"
                         styleClass="ui-noborder" id="painel">

                <p:outputLabel value="Nome" for="nome"/>
                <p:inputText id="nome" size="50" value="#{cadastroClienteBean.cliente.nome}"/>

                <p:outputLabel value="Tipo"/>
                <p:selectOneRadio id="tipo" styleClass="classeParaSelectOneRadio"
                                  value="#{cadastroClienteBean.cliente.tipo}">
                    <f:selectItem itemLabel="Física" itemValue="F"/>
                    <f:selectItem itemLabel="Jurídica" itemValue="J"/>
                </p:selectOneRadio>

                <p:outputLabel value="CNPJ" for="cnpj"/>
                <p:inputMask id="cnpj" mask="99.999.999/9999-99" size="15" value="#{cadastroClienteBean.cliente.cnpj}"/>

                <p:outputLabel value="Email" for="email"/>
                <p:inputText id="email" size="50" value="#{cadastroClienteBean.cliente.email}"/>

            </p:panelGrid>

            <p:commandButton value="Adicionar endereço" style="margin-top: 20px"
                             action="#{cadastroClienteBean.prepararEndereco}"
                             process="@this" update="panel-add-cliente"
                             oncomplete="PF('dialod-add-cliente').show(); return null;">
                <p:resetInput target="panel-add-cliente"/>
            </p:commandButton>

            <p:dataTable id="enderecos-clientes-table" style="margin-top: 10px"
                         value="#{cadastroClienteBean.cliente.enderecos}"
                         var="endereco" rows="5"
                         paginatorAlwaysVisible="false" paginatorPosition="bottom"
                         emptyMessage="Não há endereços relacionados" paginator="true">

                <p:column headerText="Logradouro" style="width: 574px">
                    <h:outputText value="#{endereco.logradouro}"/>
                </p:column>

                <p:column headerText="Número" style="width: 47px">
                    <h:outputText value="#{endereco.numero}"/>
                </p:column>

                <p:column headerText="Complemento" style="width: 107px">
                    <h:outputText value="#{endereco.complemento}"/>
                </p:column>

                <p:column headerText="CEP" style="width: 66px">
                    <h:outputText value="#{endereco.cep}" readonly="true"/>
                </p:column>

                <p:column headerText="Cidade/UF">
                    <h:outputText value="#{endereco.cidade}/#{endereco.uf}"/>
                </p:column>

                <p:column style="text-align: center; width: 72px">
                    <p:button icon="ui-icon-pencil" title="Editar"/>
                    <p:commandButton icon="ui-icon-trash" title="Excluir" process="@this"
                                     oncomplete="PF('confirm-remover-endereco-cliente').show();">
                        <f:setPropertyActionListener value="#{endereco}"
                                                     target="#{cadastroClienteBean.enderecoSelecionado}"/>
                    </p:commandButton>
                </p:column>

            </p:dataTable>

            <p:dialog widgetVar="dialod-add-cliente" header="Inclusão de endereço" modal="true" resizable="false"
                      closeOnEscape="true">

                <h:panelGroup layout="block" id="panel-add-cliente">
                    <p:messages id="msgPanel" closable="true"/>

                    <p:panelGrid columns="2" styleClass="ui-noborder" columnClasses="rotulo, campo">
                        <p:outputLabel value="Logradouro" for="logradoudoro"/>
                        <p:inputText id="logradoudoro" value="#{cadastroClienteBean.endereco.logradouro}"
                                     required="true" size="80" requiredMessage="Informe o logradouro"/>

                        <p:outputLabel value="Número" for="numero"/>
                        <p:inputText id="numero" value="#{cadastroClienteBean.endereco.numero}" required="true"
                                     requiredMessage="Informe o número"/>

                        <p:outputLabel value="Complemento" for="complemento"/>
                        <p:inputText id="complemento" value="#{cadastroClienteBean.endereco.complemento}"
                                     required="true" requiredMessage="Informe o complemento"/>

                        <p:outputLabel value="CEP" for="cep"/>
                        <p:inputText id="cep" value="#{cadastroClienteBean.endereco.cep}"/>

                        <p:outputLabel value="Cidade" for="cidade"/>

                        <p:panelGrid columns="3" style="margin-left: -9px">
                            <p:inputText id="cidade" value="#{cadastroClienteBean.endereco.cidade}"/>

                            <p:outputLabel value="UF" for="uf"/>
                            <p:inputText id="uf" value="#{cadastroClienteBean.endereco.uf}" size="5"/>
                        </p:panelGrid>

                        <p:spacer/>
                        <p:commandButton value="Incluir endereco"
                                         action="#{cadastroClienteBean.incluirEndereco}"
                                         process="@this frm:panel-add-cliente"
                                         update="msgPanel panel-add-cliente enderecos-clientes-table"
                                         oncomplete="if (!args.validationFailed) PF('dialod-add-cliente').hide()"/>
                    </p:panelGrid>
                </h:panelGroup>

            </p:dialog>

            <p:confirmDialog widgetVar="confirm-remover-endereco-cliente" header="Exclusão de enredeço"
                             message="Deseja realmente remover o endereço selecionado?">

                <p:commandButton value="Sim" action="#{cadastroClienteBean.excluirEnderecoSelecionado}"
                                 update="enderecos-clientes-table"
                                 process="@this"
                                 oncomplete="if (!args.validationFailed) {PF('confirm-remover-endereco-cliente').hide();}"/>

                <p:button value="Não" onclick="PF('confirm-remover-endereco-cliente').hide(); return false;"/>

            </p:confirmDialog>

        </h:form>

    </ui:define>

</ui:composition>